apiVersion: argoproj.io/v1alpha1
kind: AppProject
metadata:
  name: {{ .Values.tenant }}-{{ .Values.environment }}
  namespace: argocd
spec:
  description: {{ .Values.description }}
  sourceRepos:
  - {{ .Values.repo }}
{{- range .Values.otherRepos }}
  - "{{ . }}"
{{- end }}
  destinations:
  - namespace: '*'
{{- if eq .Values.cluster.apiServer "local" }}
    server: "https://kubernetes.default.svc"
{{- else }}
    server: {{ .Values.cluster.apiServer | quote }}
{{- end }}
  roles:
  - name: read-only
    description: read only access
    policies:
    - p, proj:hercules:read-only, applications, get, hercules/*, allow
    groups:
    - my-oidc-group
  - name: sync-power
    description: Sync privileges for guestbook-dev
    policies:
    - p, proj:hercules:sync-power, applications, sync, hercules/*, allow
    jwtTokens:
    - iat: 1535390316
